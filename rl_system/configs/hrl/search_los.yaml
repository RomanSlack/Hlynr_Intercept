# Search Specialist - LOS Frame (Observations + Actions)
#
# FULL LOS-FRAME IMPLEMENTATION:
# Both observations AND actions are in Line-of-Sight reference frame.
# This makes the entire control loop direction-invariant.
#
# LOS OBSERVATION SPACE (26D):
# [0]: Range to target (normalized)
# [1]: Range rate / closing speed (positive = closing)
# [2]: LOS azimuth rate (horizontal bearing change)
# [3]: LOS elevation rate (vertical bearing change)
# [4]: Off-axis angle cos (1.0 = on collision course)
# [5]: Lead angle cos (LOS vs target velocity)
# [6-8]: Own velocity [speed, climb_rate, horiz_speed]
# [12]: Fuel fraction
# [17-19]: Ground radar [range, closing, LOS_rate]
#
# LOS ACTION SPACE (6D):
# [0]: Thrust along LOS (positive = toward target)
# [1]: Thrust perpendicular horizontal (lateral correction)
# [2]: Thrust perpendicular vertical (altitude correction)
# [3-5]: Angular rates (body-relative)
#
# Target: Full 360° directional coverage for target acquisition

parent_config: ../../config.yaml

training:
  total_timesteps: 3000000  # 3M steps
  n_envs: 16
  n_steps: 2048
  batch_size: 512
  use_subproc: false

  learning_rate: 0.0003
  gamma: 0.99
  gae_lambda: 0.97

  # Entropy for exploration (search needs more exploration)
  ent_coef: 0.02
  ent_coef_final: 0.005
  ent_decay_steps: 2500000

  net_arch: [512, 512, 256]
  use_lstm: false
  use_layer_norm: true
  use_orthogonal_init: true
  frame_stack: 4

  eval_freq: 25000
  n_eval_episodes: 20
  checkpoint_freq: 500000

environment:
  max_steps: 1000

  # LOS FRAME OBSERVATIONS - direction-invariant
  observation_mode: "los_frame"

  # INTERCEPTOR SPAWN: Launch toward threat (direction-invariant)
  # CRITICAL: Base config had velocity [[20,20,40],[40,40,80]] which biases toward Q1!
  # Use velocity_mode: toward_missile so interceptor launches toward the threat
  interceptor_spawn:
    position: [[0, 0, 0], [50, 50, 10]]
    velocity_mode: "toward_missile"
    speed_min: 50.0
    speed_max: 100.0
    velocity: [[20, 20, 40], [40, 40, 80]]  # Fallback only

  # SPHERICAL SPAWN: Full 360° coverage
  missile_spawn:
    position_mode: "spherical"
    radius_min: 1200.0
    radius_max: 2500.0
    azimuth_range: [0, 360]
    elevation_range: [10, 70]
    velocity_mode: "toward_target"
    speed_min: 80.0
    speed_max: 150.0
    # Fallback box
    position: [[1200, 1200, 1000], [2500, 2500, 2000]]
    velocity: [[-60, -60, -30], [-100, -100, -50]]

curriculum:
  enabled: true
  initial_radius: 500.0
  final_radius: 300.0
  curriculum_steps: 2500000
  precision_mode: false
